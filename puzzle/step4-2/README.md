# Step4-2: puzzle リファクタリング

### 〜「Step4-2」 でやっていること〜

・操作性の改善<br>
　リロード時に、デフォルトの「レベル：３」に戻ってしまう挙動を修正。<br>
　リロード前のレベルを、ローカルストレージに保持するようにした。<br>

・バグの修正<br>
　ゲームクリア時のメッセージ表示で、「OK」ボタン押下後にローカルストレージへの書き込みを行っていた。<br>
　それだと、「OK」ボタンを押さずにリロードした場合に、ログが書き込まれず、消えてしまう。<br>
　さきに書き込みを済ませたあとに、メッセージ表示をするべきだった。<br>

・コードのリファクタリング<br>
　「db/default-db」でやってた db の初期化処理を、「event/::initialize-db」へ移動した。<br>
　ローカルストレージから「レベル」を読み出したあとに、シャッフルする必要があるため。<br>
　おかげで、db、views 層で重複定義してた「getIdxNext()」を、event に集約できた。<br>

### 〜課題〜

・レベルを変更すると、ユーザーが操作するタイル部分はシャッフルされ、再描画されるのに、<br>
　ログの部分は更新されない。どうやったらログ部分も再描画されるんだらう？<br>

※以下のファイル群は数が多いのでアップロードしてません。<br><br>

　　[ ~/node_modules/* ]<br>
　　[ ~/resource/public/js/compiled/* ]<br><br>
